<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="darkreader-lock">
    <title>A2Z DSA Course Roadmap</title>
    <style>
        :root {
            /* Theme based on the provided image */
            --primary-color: #404269;
            /* Dark blue/purple for collapsible headers */
            --primary-hover-color: #53557E;
            /* Lighter blue for hover */
            --success-color: #1a8f47;
            /* Green for active/completed sections */
            --success-hover-color: #25a95a;
            /* Lighter green for hover */

            --medium-gray: #282828;
            /* Dark grey page background */
            --white-color: #353535;
            /* Lighter dark grey for the main container */
            --border-color: #b0b0b0;
            /* Borders for tables and elements */

            --text-color: #ffffff;
            /* Main text color for headings */
            --dark-gray: #e0e4e8;
            /* Lighter text for table content */
            --light-gray: #303030;
            /* Slightly darker background for table headers */

            --link-color: #8ea1e9;
            /* Link color */
            --warning-color: #f5a623;
            /* Difficulty indicator: Medium (Orange) */
            --danger-color: #e52d27;
            /* Difficulty indicator: Hard (Red) */

            --completed-bg-color: rgba(26, 143, 71, 0.1);
            /* Subtle background for completed rows */
            --completed-text-color: #63e6be;
            /* Text color for completed topics */

            --progress-bar-bg: var(--success-color);
        }

        /* --- Responsive Font Size Setup --- */
        html {
            /* Set a base font size for the document. 16px is a common default. */
            font-size: 16px;
        }

        /* For tablets and smaller devices */
        @media (max-width: 768px) {
            html {
                font-size: 14px;
            }
        }

        /* For mobile phones */
        @media (max-width: 480px) {
            html {
                font-size: 12px;
            }

            /* Further refine heading sizes on very small screens to prevent overflow */
            h1 {
                font-size: 2rem;
            }

            .collapsible {
                font-size: 1.3rem;
            }

            .sub-collapsible {
                font-size: 1.1rem;
            }
        }

        /* --- End Responsive Font Size Setup --- */


        /* General Body Styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--medium-gray);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
        }

        /* Main Container for the Roadmap */
        .container {
            max-width: 1200px;
            margin: 1rem auto;
            background-color: var(--white-color);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        /* Heading Styles */
        h1 {
            text-align: center;
            font-size: 2.25rem;
            color: var(--text-color);
            border-bottom: 3px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }

        /* Collapsible Section Styles */
        .collapsible,
        .sub-collapsible {
            color: #fff;
            cursor: pointer;
            padding: 0.85rem 1.25rem;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            margin-top: 0.75rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.4s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            background-color: var(--primary-color);
        }

        /* Progress Bar Pseudo-element */
        .collapsible::before,
        .sub-collapsible::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress-width, 0%);
            background-color: var(--progress-bar-bg);
            transition: width 0.4s ease-out, background-color 0.4s ease;
            z-index: 1;
            /* border-radius: 10px; */
        }

        .collapsible {
            font-size: 1.5rem;
        }

        .sub-collapsible {
            font-size: 1.2rem;
        }

        .collapsible:hover,
        .collapsible.active,
        .sub-collapsible:hover,
        .sub-collapsible.active {
            background-color: var(--primary-hover-color);
        }

        .collapsible.completed,
        .sub-collapsible.completed {
            background-color: var(--success-color);
        }

        .collapsible.completed:hover,
        .collapsible.completed.active,
        .sub-collapsible.completed:hover,
        .sub-collapsible.completed.active {
            background-color: var(--success-hover-color);
        }

        .collapsible-title {
            flex-grow: 1;
        }

        .progress-counter {
            font-size: 0.7em;
            font-weight: 500;
            background-color: rgba(0, 0, 0, 0.25);
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            margin-left: 1rem;
            white-space: nowrap;
        }

        .collapsible-title,
        .progress-counter,
        .collapsible::after,
        .sub-collapsible::after {
            position: relative;
            z-index: 2;
        }

        .collapsible::after,
        .sub-collapsible::after {
            content: '+';
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.3s ease;
            margin-left: 1rem;
        }

        .collapsible.active::after,
        .sub-collapsible.active::after {
            transform: rotate(45deg);
        }

        .content,
        .sub-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
            background-color: transparent;
        }

        .content {
            border-radius: 0 0 8px 8px;
            border-top: none;
            padding: 0 0.5rem;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.75rem;
            border: 1px solid var(--border-color);
            table-layout: fixed;
            min-width: 800px;
            /* Increased from 700px to accommodate extra column */
        }

        th,
        td {
            border: 1px solid var(--border-color);
            padding: 0.4rem 0.3rem;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }

        .topic-cell {
            text-align: left;
            font-weight: 500;
            width: 35%;
            /* Reduced from 40% to make room for extra column */
        }

        thead th:not(:first-child),
        tbody td:not(.topic-cell) {
            width: 8.13%;
            /* Adjusted to accommodate 8 columns instead of 7 */
        }

        .topic-title {
            font-size: 0.95rem;
            padding: 0.5rem;
        }

        thead th {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            font-weight: 600;
        }

        /* Difficulty & Completion Styles */
        tr {
            color: var(--dark-gray);
        }

        tr.completed {
            background-color: var(--completed-bg-color) !important;
            color: var(--completed-text-color) !important;
        }

        tr.completed a {
            color: var(--completed-text-color) !important;
            font-weight: 500;
        }

        .difficulty-easy td:first-child {
            box-shadow: inset 5px 0 0 0 var(--success-color);
        }

        .difficulty-medium td:first-child {
            box-shadow: inset 5px 0 0 0 var(--warning-color);
        }

        .difficulty-hard td:first-child {
            box-shadow: inset 5px 0 0 0 var(--danger-color);
        }

        /* Link & SVG Styling */
        .link-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .link-cell:hover {
            background-color: var(--light-gray);
        }

        .link-cell a {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: -0.5rem -0.4rem;
            padding: 0.5rem 0.4rem;
            color: var(--link-color);
            text-decoration: none;
            height: 100%;
        }

        .link-cell svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .na-cell {
            color: #bdc3c7;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .status-cell {
            cursor: pointer;
        }

        .status-checkbox {
            -webkit-appearance: none;
            appearance: none;
            background-color: transparent;
            margin: auto;
            font: inherit;
            color: var(--dark-gray);
            width: 1.15em;
            height: 1.15em;
            border: 0.15em solid currentColor;
            border-radius: 0.15em;
            display: grid;
            place-content: center;
            pointer-events: none;
        }

        .status-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
            transform: scale(0);
            transform-origin: bottom left;
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em var(--success-color);
        }

        .status-checkbox:checked {
            border-color: var(--success-color);
        }

        .status-checkbox:checked::before {
            transform: scale(1);
        }
    </style>
</head>

<body>
    <div id="roadmap-container" class="container">
        <h1>Loading Roadmap...</h1>
    </div>
    <script>
        const STORAGE_KEY = 'dsaRoadmapProgress';

        const platformLogos = {
            'BLOG': `<img src="./assets/logo/post.svg" alt="BLOG">`,
            'YT': `<img src="./assets/logo/yt.svg" alt="YT">`,
            'TUF': `<img src="./assets/logo/tuf.svg" alt="TUF">`,
            'GFG': `<img src="./assets/logo/gfg.svg" alt="GFG">`,
            'CN': `<img src="./assets/logo/cn.svg" alt="CN">`,
            'LC': `<img src="./assets/logo/lc.svg" alt="LC">`,
            'ALT': `<img src="./assets/logo/alt.svg" alt="ALT">
`
        };

        document.addEventListener('DOMContentLoaded', () => {
            fetch('a2z.json').then(response => {
                if (!response.ok) throw new Error('Network response was not ok. Make sure a2z.json is in the same folder.');
                return response.json();
            }).then(roadmapData => {
                const progress = loadCompletionState();
                generateRoadmap(roadmapData, progress);
                addEventListeners();
            }).catch(handleError);
        });

        // Function to generate alternate link from original post_link
        function generateAlternateLink(postLink) {
            if (!postLink) return null;

            try {
                const url = new URL(postLink);
                const pathParts = url.pathname.split('/').filter(part => part.length > 0);

                // Convert from https://takeuforward.org/category/article-name/ 
                // to articles/category/article-name.html
                if (pathParts.length >= 2) {
                    const category = pathParts[0];
                    const articleName = pathParts[1];
                    return `a2z_old_sheet_articles/articles/${category}/web/${articleName}.html`;
                }
            } catch (error) {
                console.warn('Could not generate alternate link for:', postLink);
            }

            return null;
        }

        function generateRoadmap(data, progress) {
            const container = document.getElementById('roadmap-container');
            let htmlContent = `<h1>A2Z DSA Course Roadmap</h1>`;
            data.forEach(step => {
                let totalStepTopics = 0;
                let completedStepTopics = 0;
                let subStepsHtml = '';
                if (step.sub_steps) {
                    step.sub_steps.forEach(subStep => {
                        const totalSubStepTopics = subStep.topics.length;
                        const completedSubStepTopics = subStep.topics.filter(t => progress[t.id]).length;
                        const isSubStepComplete = totalSubStepTopics > 0 && completedSubStepTopics === totalSubStepTopics;
                        const subStepProgressClass = isSubStepComplete ? 'completed' : '';
                        const subStepPercentage = totalSubStepTopics > 0 ? (completedSubStepTopics / totalSubStepTopics) * 100 : 0;
                        totalStepTopics += totalSubStepTopics;
                        completedStepTopics += completedSubStepTopics;

                        subStepsHtml += `
                                <button type="button" class="sub-collapsible ${subStepProgressClass}" style="--progress-width: ${subStepPercentage}%" data-step="${step.step_no}" data-substep="${subStep.sub_step_no}">
                                    <span class="collapsible-title">${subStep.sub_step_no}. ${subStep.sub_step_title.replace(/\n/g, ' ')}</span>
                                    <span class="progress-counter">${completedSubStepTopics}/${totalSubStepTopics}</span>
                                </button>
                                <div class="sub-content">
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Topic</th>
                                                    <th title="Blog">BLOG</th>
                                                    <th title="Alternate Article">ALT</th>
                                                    <th title="YouTube">YT</th>
                                                    <th title="LeetCode">LC</th>
                                                    <th title="GeeksForGeeks">GFG</th>
                                                    <th title="CodingNinjas">CN</th>
                                                    <th title="TakeUForward+">TUF</th>
                                                    <th>Done</th>
                                                </tr>
                                            </thead>
                                            <tbody>`;
                        subStep.topics.forEach(topic => {
                            const isCompleted = progress[topic.id] || false;
                            const difficultyClass = getDifficultyClass(topic.difficulty);
                            const completedClass = isCompleted ? 'completed' : '';
                            const checkedAttr = isCompleted ? 'checked' : '';
                            const alternateLink = generateAlternateLink(topic.post_link);
                            let tags = '';
                            if (topic.ques_topic) {
                                try {
                                    const parsedTags = JSON.parse(topic.ques_topic);
                                    tags = parsedTags.map(t => t.label).join(', ');
                                } catch (e) {
                                    console.error('Failed to parse ques_topic:', topic.ques_topic, e);
                                }
                            }

                            subStepsHtml += `
                                                <tr class="${difficultyClass} ${completedClass}" data-topic-id="${topic.id}">
                                                    <td class="topic-cell" title="${tags}">
                                                        <div class="topic-title">${topic.question_title}</div>
                                                    </td>
                                                    ${createLinkCell(topic.post_link, 'BLOG')}
                                                    ${createLinkCell(alternateLink, 'ALT')}
                                                    ${createLinkCell(topic.yt_link, 'YT')}
                                                    ${createLinkCell(topic.lc_link, 'LC')}
                                                    ${createLinkCell(topic.gfg_link, 'GFG')}
                                                    ${createLinkCell(topic.cs_link, 'CN')}
                                                    ${createLinkCell(topic.plus_link, 'TUF')}
                                                    <td class="status-cell">
                                                        <input type="checkbox" class="status-checkbox" data-id="${topic.id}" ${checkedAttr}>
                                                    </td>
                                                </tr>`;
                        });
                        subStepsHtml += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>`;
                    });
                }
                const isStepComplete = totalStepTopics > 0 && completedStepTopics === totalStepTopics;
                const stepProgressClass = isStepComplete ? 'completed' : '';
                const stepPercentage = totalStepTopics > 0 ? (completedStepTopics / totalStepTopics) * 100 : 0;
                htmlContent += `
                            <button type="button" class="collapsible ${stepProgressClass}" style="--progress-width: ${stepPercentage}%" data-step="${step.step_no}">
                                <span class="collapsible-title">Step ${step.step_no}: ${step.step_title}</span>
                                <span class="progress-counter">${completedStepTopics}/${totalStepTopics}</span>
                            </button>
                            <div class="content">${subStepsHtml}</div>`;
            });
            container.innerHTML = htmlContent;
        }

        function createLinkCell(url, label) {
            if (url) {
                const logo = platformLogos[label] || label;
                return `<td class="link-cell"><a href="${url}" target="_blank" rel="noopener noreferrer" title="${label}">${logo}</a></td>`;
            } else {
                return `<td class="na-cell">-</td>`;
            }
        }

        function getDifficultyClass(difficulty) {
            return ['difficulty-easy', 'difficulty-medium', 'difficulty-hard'][difficulty] || '';
        }

        function loadCompletionState() {
            try {
                const savedProgress = localStorage.getItem(STORAGE_KEY);
                return savedProgress ? JSON.parse(savedProgress) : {};
            } catch (e) {
                console.error("Failed to load progress from localStorage", e);
                return {};
            }
        }

        function saveCompletionState(progress) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            } catch (e) {
                console.error("Failed to save progress to localStorage", e);
            }
        }

        function updateCounters(element) {
            const progress = loadCompletionState();
            const subStepContent = element.closest('.sub-content');
            if (subStepContent) {
                const subStepButton = subStepContent.previousElementSibling;
                const topicsInSubStep = Array.from(subStepContent.querySelectorAll('.status-checkbox'));
                const totalSubStep = topicsInSubStep.length;
                const completedSubStep = topicsInSubStep.filter(cb => progress[cb.dataset.id]).length;
                subStepButton.querySelector('.progress-counter').textContent = `${completedSubStep}/${totalSubStep}`;

                const subStepPercentage = totalSubStep > 0 ? (completedSubStep / totalSubStep) * 100 : 0;
                subStepButton.style.setProperty('--progress-width', `${subStepPercentage}%`);
                subStepButton.classList.toggle('completed', totalSubStep > 0 && completedSubStep === totalSubStep);
            }
            const mainContent = element.closest('.content');
            if (mainContent) {
                const mainStepButton = mainContent.previousElementSibling;
                const topicsInStep = Array.from(mainContent.querySelectorAll('.status-checkbox'));
                const totalStep = topicsInStep.length;
                const completedStep = topicsInStep.filter(cb => progress[cb.dataset.id]).length;
                mainStepButton.querySelector('.progress-counter').textContent = `${completedStep}/${totalStep}`;

                const stepPercentage = totalStep > 0 ? (completedStep / totalStep) * 100 : 0;
                mainStepButton.style.setProperty('--progress-width', `${stepPercentage}%`);
                mainStepButton.classList.toggle('completed', totalStep > 0 && completedStep === totalStep);
            }
        }

        function addEventListeners() {
            const container = document.getElementById('roadmap-container');
            container.addEventListener('click', function (event) {
                const collapsible = event.target.closest('.collapsible, .sub-collapsible');
                const statusCell = event.target.closest('.status-cell');

                if (collapsible) {
                    collapsible.classList.toggle('active');
                    const content = collapsible.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        const parentContent = content.closest('.content');
                        if (parentContent && parentContent.style.maxHeight) {
                            parentContent.style.maxHeight = (parentContent.scrollHeight + content.scrollHeight) + "px";
                        }
                    }
                }

                if (statusCell) {
                    const checkbox = statusCell.querySelector('.status-checkbox');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        const topicId = checkbox.dataset.id;
                        const isChecked = checkbox.checked;
                        const progress = loadCompletionState();
                        progress[topicId] = isChecked;
                        saveCompletionState(progress);
                        checkbox.closest('tr').classList.toggle('completed', isChecked);
                        updateCounters(checkbox);
                    }
                }
            });
        }

        function handleError(error) {
            console.error('Error:', error);
            const container = document.getElementById('roadmap-container');
            container.innerHTML = `
                <h1>Error</h1>
                <p>Could not load the roadmap. Please ensure 'a2z.json' is in the same directory and correctly formatted.</p>
                <p><em>${error.message}</em></p>`;
        }
    </script>
</body>

</html>